{% extends "layout.html" %}
{% load static %}

{% block title %}
{{ block.super }} - {{ product.title }}
{% endblock %}

{% block content %}
<div class="hero bg-base-200 min-h-screen">
  <div class="hero-content">
    <div class="card bg-base-100 sm:w-xl w-auto shadow-sm">
      <figure>
        {% for image in product.product_image.all %}
        {% if image.is_feature %}
        <img src="{{ image.image.url }}" alt="{{ image.alt_text }}">
        {% endif %}
        {% endfor %}
      </figure>
      <div class="card-body">
        <div class="flex md:items-center justify-between">
          <h1 class="sm:flex-row sm:items-center flex-col items-start card-title font-bold text-2xl">
            {{ product.title|title }}
            <span class="badge badge-accent text-xs">{{ product.category }}</span>
          </h1>
          <span class="text-xl">${{ product.regular_price }}</span>
        </div>
        <p>{{ product.description }}</p>
        <div class="flex justify-between">
          <button id="button-add" value="{{ product.id }}" class="btn sm:w-sm w-auto btn-secondary">
            Add to Cart
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
            </svg>
          </button>
          <select id="select" class="select select-info focus:outline-none w-fit">
            <option value=1>1</option>
            <option value=2>2</option>
            <option value=3>3</option>
            <option value=4>4</option>
          </select>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  $(document).on('click', '#button-add', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '{% url "basket:basket_add" %}',
      data: {
        productid: $('#button-add').val(),
        productqty: $('#select option:selected').text(),
        csrfmiddlewaretoken: "{{ csrf_token }}",
        action: 'post'
      },
      success: function (json) {
        document.getElementById('qty-basket').innerHTML = json.qty || 0;
      },
      error: function (xhr, errmsg, err) { }
    });
  })
</script>
{% endblock %}
